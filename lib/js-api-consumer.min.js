/*! js-api-consumer 2013-12-17 */
!function(a){a.fn.extend({formSearch:function(b){return b=b||{},"destroy"===b?this.each(function(){a(this).typeahead("destroy"),a(this).off("typeahead:selected"),a(this).off("typeahead:autocompleted")}):this.each(function(){var c,d,e;e=this,d="https://staging.api.covermymeds.com/forms?v="+CMM_API_CONFIG.version,a(this).typeahead({name:"form_api",header:"Results",template:'<p style="overflow: auto;"><img src="<%= thumbnail_url %>" style="float: left;"><%= value %></p>',engine:{compile:function(a){var b=_.template(a);return{render:function(a){return b(a)}}}},remote:{url:b.url?b.url+"&q=%QUERY&state=%STATE&drug_id=%DRUG_ID":d+"&q=%QUERY&state=%STATE&drug_id=%DRUG_ID",replace:function(c,d){var e,f;return e=b.state||a('select[name="request[state]"]').val(),f=b.drugId||a('input[name="request[drug_id]"]').data("drug-id"),c.replace("%QUERY",d).replace("%STATE",e).replace("%DRUG_ID",f)},filter:function(a){var b,c,d=[];for(b=0,c=a.forms.length;c>b;b+=1)d.push({id:a.forms[b].request_form_id,value:a.forms[b].description,thumbnail_url:a.forms[b].thumbnail_url});return d},beforeSend:function(c){return b.url?void 0:a(e).val().length<4?!1:(c.setRequestHeader("Authorization","Basic "+Base64.encode(CMM_API_CONFIG.apiId+":"+CMM_API_CONFIG.apiSecret)),void 0)}}}),c=function(b,c){a(this).attr("data-form-name",c.value),a(this).attr("data-form-id",c.id)},a(this).on("typeahead:selected",c),a(this).on("typeahead:autocompleted",c)})}})}(jQuery),function(a){a.fn.extend({drugSearch:function(b){return b=b||{},"destroy"===b?this.each(function(){a(this).typeahead("destroy"),a(this).off("typeahead:selected"),a(this).off("typeahead:autocompleted")}):this.each(function(){var c,d;d="https://staging.api.covermymeds.com/drugs?v="+CMM_API_CONFIG.version,a(this).typeahead({name:"drug_api",header:'<span class="dropdown-header">Results</span>',remote:{url:b.url?b.url+"&q=%QUERY":d+"&q=%QUERY",filter:function(a){var b,c,d=[];for(b=0,c=a.drugs.length;c>b;b+=1)d.push({value:a.drugs[b].full_name,id:a.drugs[b].id});return d},beforeSend:function(a){b.url||a.setRequestHeader("Authorization","Basic "+Base64.encode(CMM_API_CONFIG.apiId+":"+CMM_API_CONFIG.apiSecret))}}}),c=function(b,c){a(this).attr("data-drug-name",c.value),a(this).attr("data-drug-id",c.id)},a(this).on("typeahead:selected",c),a(this).on("typeahead:autocompleted",c)})}})}(jQuery),function(a){a.fn.extend({createRequest:function(b){if(b=b||{request:{}},"destroy"===b)return this.each(function(){a(this).off("click")});var c=['<div class="modal fade">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>','<h4 class="modal-title">Modal title</h4>',"</div>",'<div class="modal-body">',"<p>One fine body&hellip;</p>","</div>",'<div class="modal-footer">','<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>','<button type="button" class="btn btn-primary">Save changes</button>',"</div>","</div><!-- /.modal-content -->","</div><!-- /.modal-dialog -->","</div><!-- /.modal -->"];return a("body").append(c.join("\n")),this.each(function(){var c,d;c="https://staging.api.covermymeds.com/requests?v="+CMM_API_CONFIG.version,d=b.url?{}:{Authorization:"Basic "+Base64.encode(CMM_API_CONFIG.apiId+":"+CMM_API_CONFIG.apiSecret)},a(this).on("click",function(e){e.preventDefault(),a.ajax({url:b.url||c,type:"POST",headers:d,data:{request:{form_id:b.form_id||a('input[name="request[form_id]"]').data("form-id"),state:b.state||a('select[name="request[state]"]').val(),patient:{first_name:b.first_name||a('input[name="request[patient][first_name]"]').val(),last_name:b.last_name||a('input[name="request[patient][last_name]"]').val(),date_of_birth:b.date_of_birth||a('input[name="request[patient][date_of_birth]"]').val()},prescription:{drug_id:b.drug_id||a('input[name="request[prescription][drug_id]"]').data("drug-id")}}},success:function(){a(".modal-body").text("Your request was created."),a(".modal").modal()},error:function(){a(".modal-body").text("There was an error processing your request."),a(".modal").modal()}})})})}})}(jQuery),function(a){a.fn.extend({dashboard:function(b){return b=b||{},this.each(function(){var c,d;d=this,c="https://staging.api.covermymeds.com/requests/search?v="+CMM_API_CONFIG.version+"&api_id="+CMM_API_CONFIG.apiId+"&api_secret="+CMM_API_CONFIG.apiSecret,a.ajax({url:b.url||c,type:"POST",data:{ids:b.ids},success:function(b){var c;c=_.template('<% _.each(requests, function (request) { %><div class="request row"><div class="col-lg-2"><img src="<%= request.thumbnail_urls %>" /></div><div class="col-lg-4"><ul><li><h4><%= request.patient.first_name %> <%= request.patient.last_name %> (Key: <%= request.id %>)</h4></li><li><strong>Status:</strong> <span class="label label-info"><%= request.workflow_status %></span><li>Drug Name Here</li><li><strong>Created:</strong> <%= request.created_at %></li><li><a href="<%= request.tokens[0].html_url %>">View</a></li></ul></div></div><% }); %>'),a(d).append(c(b))},error:function(){a(".modal-body").text("There was an error processing your request."),a(".modal").modal()}})})}})}(jQuery);var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};